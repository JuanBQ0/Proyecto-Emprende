<app-navbar-docente></app-navbar-docente>

<main class="ml-64 pt-6 px-4 sm:px-8 md:px-12 lg:px-16 min-h-screen bg-green-200">

  <h2 class="text-2xl sm:text-3xl font-bold text-green-800 mb-8">
    Proyectos asignados
  </h2>

  <!-- FILTROS / B√öSQUEDA (opcional) -->

  @if (proyectos.length === 0) {
    <div class="bg-white p-8 rounded-lg shadow-md text-center text-gray-600 font-semibold">
      No tienes proyectos asignados actualmente.
    </div>
  } @else {
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">

      @for (p of proyectos; track p.id) {

        <article class="bg-white rounded-lg shadow-md p-6 flex flex-col border border-green-200 hover:shadow-lg transition">

          <!-- Cabecera resumen -->
          <div class="flex justify-between items-start mb-5">
            <div class="flex flex-col gap-1">
              <h3 class="font-bold text-green-800 text-lg">{{ p.nombreProyecto }}</h3>
              <p class="text-xs text-gray-500">Fecha: {{ p.fecha | date:'dd/MM/yyyy' }}</p>
            </div>

            <span
              class="px-3 py-1 rounded-full text-xs font-semibold mt-1"
              [ngClass]="{
                'bg-green-200 text-green-800': p.estadoSeguimiento === 'Activo',
                'bg-yellow-200 text-yellow-800': p.estadoSeguimiento === 'Inactivo',
                'bg-blue-200 text-blue-800': p.estadoSeguimiento === 'Graduado',
                'bg-gray-200 text-gray-600': !p.estadoSeguimiento
              }"
            >
              {{ p.estadoSeguimiento || 'Sin estado' }}
            </span>
          </div>

          <!-- Botones de acci√≥n / cambiar estado -->
          <div class="mb-5">
            <select
              [(ngModel)]="p.estadoSeguimiento"
              class="border rounded-md px-3 py-2 text-sm w-full focus:outline-none focus:ring-2 focus:ring-green-500"
            >
              <option value="Activo">Activo</option>
              <option value="Inactivo">Inactivo</option>
              <option value="Graduado">Graduado</option>
            </select>
          </div>

          <!-- Detalles colapsables / accorde√≥n -->
          <details class="flex-1 flex flex-col">
            <summary class="cursor-pointer text-sm font-semibold text-green-700 mb-3 select-none">
              üë• Ver estudiantes & observaciones
            </summary>

            <!-- Estudiantes -->
            <div class="mb-4">
              <h4 class="text-sm font-semibold text-green-700 mb-2">Estudiantes</h4>
              <ul class="text-sm text-gray-700 space-y-1">
                @for (e of p.estudiantes; track e.identificacion) {
                  <li>{{ e.nombres }} {{ e.apellidos }} ({{ e.identificacion }})</li>
                }
              </ul>
            </div>

            <!-- Observaciones -->
            <div class="mb-4">
              <h4 class="text-sm font-semibold text-green-700 mb-2">üóíÔ∏è Observaciones</h4>
              <ul class="space-y-1 max-h-36 overflow-y-auto p-1 border rounded bg-gray-50">
                @for (obs of p.observacionesSeguimiento || []; track obs) {
                  <li class="text-xs bg-white rounded p-2 border">{{ obs }}</li>
                }
              </ul>
            </div>

            <!-- Nueva observaci√≥n -->
            <textarea
              rows="3"
              [(ngModel)]="observacionesTemp[p.id]"
              class="border rounded-md px-3 py-2 text-sm mb-3 resize-none w-full focus:outline-none focus:ring-2 focus:ring-green-500"
              placeholder="Agregar observaci√≥n..."
            ></textarea>

            <button
              (click)="agregarObservacion(p.id)"
              class="bg-green-700 hover:bg-green-800 transition text-white py-2 rounded-md text-sm font-semibold w-full"
            >
              üìù Guardar observaci√≥n
            </button>
          </details>

        </article>

      }

    </div>
  }

  <!-- Toast -->
  <div *ngIf="mostrarToast" class="fixed bottom-5 right-5 bg-green-700 text-white px-4 py-2 rounded-lg shadow-lg z-50">
    {{ mensajeToast }}
  </div>

</main>
