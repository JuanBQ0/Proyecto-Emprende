<nav-administrativo></nav-administrativo>

<main class="ml-64 pt-24 min-h-screen bg-gray-100">

  <!-- HEADER -->
  <header class="max-w-7xl mx-auto px-6 mb-8">
    <h1 class="text-3xl font-bold tracking-wide text-green-800 mb-2">
      Seguimiento de Proyectos
    </h1>

    <p class="text-sm text-gray-600">
      Consulta, control y seguimiento de emprendimientos activos.
    </p>
  </header>

  <!-- FILTROS -->
  <section class="max-w-7xl mx-auto px-6 mb-10">

    <div
      class="bg-white border border-gray-200 rounded-xl shadow-sm p-6 grid gap-4 sm:grid-cols-2 md:grid-cols-3 items-end">

      <!-- BUSCAR POR C√âDULA -->
      <div class="flex flex-col gap-1">
        <label class="text-xs font-medium text-gray-600">
          Buscar por c√©dula
        </label>

        <input
          type="text"
          inputmode="numeric"
          maxlength="15"
          class="border rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-500 focus:outline-none"
          placeholder="Ej: 1098765432"
          [(ngModel)]="busquedaCedula"
          (input)="validarSoloNumeros($event, 'busqueda'); filtrar()"
        />

        <small *ngIf="cedulaInvalida" class="text-red-500 text-xs">
          ‚ö†Ô∏è Solo se permiten n√∫meros
        </small>


      </div>


      <!-- FILTRO ESTADO -->
      <div class="flex flex-col gap-1">
        <label class="text-xs font-medium text-gray-600">
          Estado del proyecto
        </label>

        <select
          class="border rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-500 focus:outline-none"
          [(ngModel)]="filtroEstado"
          (change)="filtrar()">
          <option value="Todos">Todos</option>
          <option value="Activo">Activos</option>
          <option value="Inactivo">Inactivos</option>
          <option value="Graduado">Graduados</option>
        </select>
      </div>

      <!-- FILTRO EXTERNOS -->
      <div class="flex flex-col gap-1">
        <label class="text-xs font-medium text-gray-600">
          Tipo de participante
        </label>

        <select
          class="border rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-500 focus:outline-none"
          [(ngModel)]="filtroTipo"
          (change)="filtrar()">
          <option value="Todos">Todos</option>
          <option value="Externos">Microempresarios externos</option>
        </select>
      </div>

    </div>

  </section>

  <!-- LISTADO -->
  <section
  class="max-w-7xl mx-auto px-6 pb-16 grid gap-6
         grid-cols-1 sm:grid-cols-2 lg:grid-cols-3">

    @for (proyecto of proyectosFiltrados; track proyecto.id) {

      <article
  class="bg-white border border-gray-200 rounded-xl p-4
         shadow-sm hover:shadow-md transition
         flex flex-col h-full"
>

<!-- HEADER -->
<div class="flex justify-between items-start gap-3 mb-3">

  <div>
    <h2 class="text-lg font-semibold text-gray-800">
      {{ proyecto.nombreProyecto }}
    </h2>

    <p class="text-xs text-gray-500">
      Estudiante:
      <span class="font-medium">
        {{ proyecto.estudiantes[0].nombres }}
        {{ proyecto.estudiantes[0].apellidos }}
      </span>
    </p>

    <p class="text-xs text-gray-400">
      Docente:
      {{ proyecto.docenteAsignadoId || 'No asignado' }}
    </p>
  </div>

  <!-- BADGE ESTADO -->
  <span
    class="px-3 py-1 h-fit text-xs rounded-full font-semibold whitespace-nowrap"
    [ngClass]="{
      'bg-green-100 text-green-700': proyecto.estadoSeguimiento === 'Activo',
      'bg-yellow-100 text-yellow-700': proyecto.estadoSeguimiento === 'Inactivo',
      'bg-blue-100 text-blue-700': proyecto.estadoSeguimiento === 'Graduado',
      'bg-gray-100 text-gray-600': !proyecto.estadoSeguimiento
    }"
  >
    {{ proyecto.estadoSeguimiento || 'Sin estado' }}
  </span>
</div>

<!-- FORM CONTROLES -->
<div class="grid grid-cols-1 gap-3 mb-3">

  <!-- DOCENTE -->
  <div>
    <label class="text-xs text-gray-500 block mb-1">
      Numero de Cedula del Docente
    </label>

    <input
      type="text"
      inputmode="numeric"
      maxlength="15"
      class="border rounded-lg w-full px-3 py-1.5 text-sm"
      placeholder="ID docente"
      [(ngModel)]="proyecto.docenteAsignadoId"
      (input)="validarSoloNumeros($event, 'docente', proyecto)"
    />

    <small
      *ngIf="docenteInvalido[proyecto.id]"
      class="text-red-500 text-xs"
    >
      ‚ö†Ô∏è Solo se permiten n√∫meros
    </small>

  </div>

  <!-- ESTADO -->
  <div>
    <label class="text-xs text-gray-500 block mb-1">
      Seleccionar Estado del Proyecto
    </label>

    <select
      class="border rounded-lg w-full px-3 py-1.5 text-sm"
      [(ngModel)]="proyecto.estadoSeguimiento">
      <option value="Activo">Activo</option>
      <option value="Inactivo">Inactivo</option>
      <option value="Graduado">Graduado</option>
    </select>
  </div>

  <!-- OBSERVACI√ìN -->
  <div>
    <label class="text-xs text-gray-500 block mb-1">
      Nueva observaci√≥n
    </label>

    <textarea
      rows="3"
      class="border rounded-lg w-full px-3 py-2 text-sm resize-none focus:ring-2 focus:ring-purple-400 focus:outline-none"
      placeholder="Escribe la observaci√≥n..."
      [(ngModel)]="observacionesTemp[proyecto.id]"
    ></textarea>
  </div>

</div>

<hr class="my-2 border-gray-200">

<!-- HISTORIAL -->
<div class="flex-1 overflow-y-auto mb-3">

  <p class="text-sm font-semibold text-gray-700 mb-2">
    Historial
  </p>

  <ul class="space-y-2">

    @for (obs of proyecto.observacionesSeguimiento || []; track obs) {

      <li class="bg-gray-50 p-2 rounded border text-xs text-gray-700 leading-relaxed">
        {{ obs }}
      </li>

    }

  </ul>

</div>

<!-- BOT√ìN -->
<button
  class="mt-auto bg-green-700 hover:bg-green-800 text-white w-full py-2 rounded-lg transition font-semibold"
  (click)="actualizarProyecto(proyecto)">
  ‚úÖ Actualizar proyecto
</button>
<button
  class="mt-2 bg-red-600 hover:bg-red-700 text-white w-full py-2 rounded-lg transition font-semibold"
  (click)="eliminarProyecto(proyecto.id)">
  üóëÔ∏è Eliminar proyecto
</button>

</article>
}
  </section>
  <div
  *ngIf="mostrarToast"
  class="fixed bottom-5 right-5
         bg-green-700 text-white
         px-4 py-3 rounded-lg shadow-lg
         animate-bounce-in z-50">

  {{ mensajeToast }}
</div>
</main>
