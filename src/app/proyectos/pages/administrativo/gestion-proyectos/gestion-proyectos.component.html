<nav-administrativo></nav-administrativo>

<div class="ml-64 min-h-screen bg-white px-6 py-12 space-y-16">

  <!-- ========= üéØ FILTROS ========= -->
  <div class="mb-6 flex flex-col md:flex-row gap-4">

    <!-- Estado -->
    <div class="flex flex-col w-full md:w-48">
      <label class="text-sm font-semibold text-green-800 mb-1">
        Filtrar por estado
      </label>

      <select
        [(ngModel)]="filtroEstado"
        (change)="aplicarFiltros()"
        class="border border-green-400 rounded-md p-2 focus:ring-2 focus:ring-green-600 bg-white"
      >
        <option value="Todos">Todos</option>
        <option value="Activo">Activo</option>
        <option value="Inactivo">Inactivo</option>
        <option value="Graduado">Graduado</option>
      </select>
    </div>

    <!-- Tipo -->
    <div class="flex flex-col w-full md:w-64">
      <label class="text-sm font-semibold text-green-800 mb-1">
        Tipo de emprendedor
      </label>

      <select
        [(ngModel)]="filtroTipo"
        (change)="aplicarFiltros()"
        class="border border-green-400 rounded-md p-2 focus:ring-2 focus:ring-green-600 bg-white"
      >
        <option value="Todos">Todos</option>
        <option value="Externos">Microempresario externo</option>
      </select>
    </div>

  </div>

  <!-- ========= üîç BUSCADOR ========= -->
  <h2 class="text-xl sm:text-2xl md:text-3xl font-bold text-green-800 mb-4 flex items-center">
    Buscar proyecto por n√∫mero de identificaci√≥n del estudiante emprendedor
  </h2>

  <div class="mb-6 flex flex-wrap gap-3 items-center">

    <input
      type="text"
      [(ngModel)]="busquedaIdentificacion"
      placeholder="Buscar por identificaci√≥n del estudiante..."
      class="flex-1 border border-green-400 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-green-600 bg-white"
    />

    <button
      (click)="aplicarFiltros()"
      class="bg-green-700 text-white px-4 py-2 rounded-md hover:bg-green-800 transition"
    >
      Buscar
    </button>

    <button
      *ngIf="busquedaActiva"
      (click)="limpiarBusqueda()"
      class="bg-gray-400 text-white px-4 py-2 rounded-md hover:bg-gray-500 transition"
    >
      Limpiar
    </button>

  </div>

  <!-- ========= üìÇ CONTENIDO ========= -->
  <div class="flex flex-col md:flex-row">

    <div class="flex-1 max-w-full mx-auto p-4 sm:p-6 bg-white shadow-md rounded-md">

      <h2
        class="text-xl sm:text-2xl md:text-3xl font-bold text-green-800 mb-6 border-b-4 border-yellow-400 pb-2 flex items-center gap-2"
      >
        <span>üìÅ</span>
        <span>Proyectos Registrados</span>
      </h2>

      <!-- ========= üì± VISTA M√ìVIL ========= -->
      <div class="block sm:hidden space-y-6">

        @for (item of proyectosFiltrados; track item.id; let i = $index) {
          <div class="border border-green-300 rounded-lg shadow-sm p-4 bg-green-50 relative">

            <button
              (click)="eliminarProyecto(item.id)"
              class="absolute top-2 right-2 text-red-600 hover:text-red-800 font-bold"
            >
              ‚úñ
            </button>

            <h3 class="text-lg font-bold text-green-800 mb-2">
              {{ i + 1 }}. {{ item.nombreProyecto }}
            </h3>

            <!-- ESTADO -->
            <span
              class="inline-block mb-2 px-3 py-1 text-xs rounded-full font-semibold"
              [ngClass]="{
                'bg-green-200 text-green-800': item.estadoSeguimiento === 'Activo',
                'bg-yellow-200 text-yellow-800': item.estadoSeguimiento === 'Inactivo',
                'bg-blue-200 text-blue-800': item.estadoSeguimiento === 'Graduado',
                'bg-gray-200 text-gray-600': !item.estadoSeguimiento
              }"
            >
              {{ item.estadoSeguimiento || 'Sin estado' }}
            </span>

            <!-- DOCENTE -->
            <p class="text-sm text-green-700 italic mb-2">
              üë©‚Äçüè´ Docente:
              <span class="font-semibold">
                {{ item.docenteAsignadoId || 'No asignado' }}
              </span>
            </p>

            <p class="text-sm text-green-700 mb-3">
              <strong>Fecha:</strong> {{ item.fecha | date: 'dd/MM/yyyy' }}
            </p>

            <!-- ESTUDIANTES -->
            <h4 class="font-semibold text-green-900 mb-2">üë• Estudiantes</h4>

            <div class="space-y-2">
              @for (est of item.estudiantes; track est.identificacion) {

                <div class="border rounded-md p-2 bg-white shadow-sm">

                  <p class="text-sm"><strong>Nombre:</strong>
                    {{ est.nombres }} {{ est.apellidos }}</p>

                  <p class="text-sm"><strong>G√©nero:</strong> {{ est.genero }}</p>

                  <p class="text-sm"><strong>Programa:</strong>
                    {{ est.programaAcademico }}</p>

                  <p class="text-sm"><strong>Correo:</strong> {{ est.correo }}</p>

                  <p class="text-sm"><strong>Celular:</strong> {{ est.tel }}</p>

                  <p class="text-sm"><strong>ID:</strong> {{ est.identificacion }}</p>

                  <p class="text-sm"><strong>UPC:</strong>
                    {{ est.EstudianteUPC ? 'S√≠' : 'No' }}</p>

                </div>

              }
            </div>

          </div>
        }

      </div>

      <!-- ========= üíª VISTA ESCRITORIO ========= -->
      <div class="hidden sm:block overflow-x-auto">

        <table class="w-full table-auto border border-green-300 text-sm">

          <thead class="bg-green-100 text-green-900">
            <tr>
              <th class="p-3 border w-10">#</th>
              <th class="p-3 border w-56">Proyecto</th>
              <th class="p-3 border w-32">Fecha</th>
              <th class="p-3 border w-24 text-center">Estado</th>
              <th class="p-3 border w-48 text-center">Docente</th>
              <th class="p-3 border w-48">Estudiante</th>
              <th class="p-3 border w-24">G√©nero</th>
              <th class="p-3 border w-48">Programa</th>
              <th class="p-3 border w-64">Correo</th>
              <th class="p-3 border w-32">Celular</th>
              <th class="p-3 border w-32">Identificaci√≥n</th>
              <th class="p-3 border w-24">UPC</th>
              <th class="p-3 border w-32">Tipo</th>
              <th class="p-3 border w-36 text-center">Acciones</th>

            </tr>
          </thead>

          <tbody>

            @for (item of proyectosFiltrados; track item.id; let i = $index) {
              @for (est of item.estudiantes; track est.identificacion; let j = $index) {

                <tr>

                  @if (j === 0) {
                    <td class="p-3 border font-semibold" [attr.rowspan]="item.estudiantes.length">{{ i + 1 }}</td>
                    <td class="p-3 border font-semibold" [attr.rowspan]="item.estudiantes.length">{{ item.nombreProyecto }}</td>
                    <td class="p-3 border" [attr.rowspan]="item.estudiantes.length">{{ item.fecha | date:'dd/MM/yyyy' }}</td>

                    <td class="p-3 border text-center" [attr.rowspan]="item.estudiantes.length">
                      <span
                        class="inline-block px-3 py-1 text-xs rounded-full font-semibold"
                        [ngClass]="{
                          'bg-green-200 text-green-800': item.estadoSeguimiento === 'Activo',
                          'bg-yellow-200 text-yellow-800': item.estadoSeguimiento === 'Inactivo',
                          'bg-blue-200 text-blue-800': item.estadoSeguimiento === 'Graduado',
                          'bg-gray-200 text-gray-600': !item.estadoSeguimiento
                        }"
                      >
                        {{ item.estadoSeguimiento || 'Sin estado' }}
                      </span>
                    </td>

                    <td class="p-3 border text-center font-medium" [attr.rowspan]="item.estudiantes.length">
                      {{ item.docenteAsignadoId || 'No asignado' }}
                    </td>
                  }

                  <td class="p-3 border">{{ est.nombres }} {{ est.apellidos }}</td>
                  <td class="p-3 border">{{ est.genero }}</td>
                  <td class="p-3 border">{{ est.programaAcademico }}</td>
                  <td class="p-3 border break-words">{{ est.correo }}</td>
                  <td class="p-3 border">{{ est.tel }}</td>
                  <td class="p-3 border">{{ est.identificacion }}</td>
                  <td class="p-3 border">{{ est.EstudianteUPC ? 'S√≠' : 'No' }}</td>
                  <td class="p-3 border">{{ est.tipoParticipante }}</td>

                  @if (j === 0) {
                    <td class="p-3 border text-center" [attr.rowspan]="item.estudiantes.length">
                    <button
                      (click)="editarProyecto(item)"
                      class="text-blue-600 hover:text-blue-800 font-bold mr-2">
                      ‚úèÔ∏è
                    </button>

                    <button
                      (click)="eliminarProyecto(item.id)"
                      class="text-red-600 hover:text-red-800 font-bold">
                      ‚úñ
                    </button>

                  </td>
                  }

                </tr>

              }
            }

          </tbody>

        </table>

      </div>

    </div>

  </div>

</div>

@if (proyectoEnEdicion) {

<div class="fixed inset-0 bg-black/40 flex items-center justify-center z-50">

  <div class="bg-white p-6 rounded-xl w-full max-w-xl space-y-4">

    <h3 class="text-2xl font-bold text-green-800">‚úèÔ∏è Editar Proyecto</h3>

    <!-- NOMBRE DEL PROYECTO -->
    <div>
      <label class="block text-sm font-medium">Nombre del proyecto</label>
      <input
        [(ngModel)]="proyectoEnEdicion.nombreProyecto"
        class="w-full border p-2 rounded"
        placeholder="Nombre del proyecto"
      />
    </div>

    <h4 class="font-semibold text-green-700 mt-2">Estudiantes</h4>

    @for (est of proyectoEnEdicion.estudiantes; track est.identificacion) {

      <div class="border p-3 rounded bg-green-50 space-y-3">

        <!-- NOMBRE -->
        <div>
          <label class="block text-sm font-medium">Nombre(s)</label>
          <input
            [(ngModel)]="est.nombres"
            class="w-full border p-2 rounded"
            placeholder="Nombre del estudiante"
          />
        </div>

        <!-- APELLIDO -->
        <div>
          <label class="block text-sm font-medium">Apellido(s)</label>
          <input
            [(ngModel)]="est.apellidos"
            class="w-full border p-2 rounded"
            placeholder="Apellido del estudiante"
          />
        </div>

        <!-- PROGRAMA -->
        <div>
          <label class="block text-sm font-medium">Programa acad√©mico</label>
          <select
            [(ngModel)]="est.programaAcademico"
            class="w-full border p-2 rounded"
          >
            <option value="" disabled>Selecciona un programa</option>
            @for (p of programas; track p) {
              <option [value]="p">{{ p }}</option>
            }
          </select>
        </div>

        <!-- CORREO -->
        <div>
          <label class="block text-sm font-medium">Correo</label>
          <input
            [(ngModel)]="est.correo"
            type="email"
            class="w-full border p-2 rounded"
            placeholder="correo@ejemplo.com"
          />
        </div>

        <!-- CELULAR -->
        <div>
          <label class="block text-sm font-medium">Celular</label>
          <input
            [(ngModel)]="est.tel"
            class="w-full border p-2 rounded"
            placeholder="3100000000"
            pattern="^[0-9]{7,15}$"
          />
        </div>

        <!-- IDENTIFICACI√ìN -->
        <div>
          <label class="block text-sm font-medium">Identificaci√≥n</label>
          <input
            [(ngModel)]="est.identificacion"
            class="w-full border p-2 rounded"
          />
        </div>

      </div>
    }

    <!-- BOTONES -->
    <div class="flex justify-end gap-3 pt-4">

      <button
        class="px-4 py-2 rounded bg-gray-400 text-white"
        (click)="cancelarEdicion()"
      >
        Cancelar
      </button>

      <button
        class="px-4 py-2 rounded bg-green-700 text-white hover:bg-green-800"
        (click)="guardarCambios()"
      >
        Guardar cambios
      </button>

    </div>

  </div>
</div>

}
